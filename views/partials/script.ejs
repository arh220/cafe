<script src="/js/jquery.min.js"></script>
<script src="/js/jquery-migrate-3.0.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.easing.1.3.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.stellar.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/aos.js"></script>
<script src="/js/jquery.animateNumber.min.js"></script>
<script src="/js/bootstrap-datepicker.js"></script>
<script src="/js/jquery.timepicker.min.js"></script>
<script src="/js/scrollax.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script src="/js/google-map.js"></script>
<script src="/js/main.js"></script>
<!-- DOB-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const today = new Date().toISOString().split('T')[0];
        const dobInput = document.getElementById("dob");
        if (dobInput) {
            dobInput.setAttribute("max", today);
        }
    });
</script>
<!-- Mobile-->
<script>
    const mobileInput = document.getElementById('mobile');

    mobileInput.addEventListener('input', function () {
        // Remove non-digit characters
        this.value = this.value.replace(/\D/g, '');

        // Limit to 10 digits
        if (this.value.length > 10) {
            this.value = this.value.slice(0, 10);
        }
    });
</script>
<!-- Highlight current page in navbar-->
<script>
    // Highlight current page in navbar
    document.addEventListener("DOMContentLoaded", function () {
        const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
        const currentPath = window.location.pathname;

        navLinks.forEach(link => {
            const linkPath = link.getAttribute('href');

            if (linkPath === currentPath) {
                // Remove 'active' from all items first
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

                // Add 'active' to the parent li
                link.closest('.nav-item').classList.add('active');
            }
        });
    });
</script>
<!-- cart page -->
<script>
    function renderCartFromLocalStorage() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartBody = document.getElementById("cartBody");
        cartBody.innerHTML = "";

        let subtotal = 0;

        if (cart.length === 0) {
            cartBody.innerHTML = '<tr><td colspan="6" class="text-center text-white">Cart is empty</td></tr>';
            document.getElementById("subtotalDisplay").textContent = "0.00";
            document.getElementById("grandTotal").textContent = "50.00";
            return;
        }

        cart.forEach(item => {
            const total = item.qty * item.price;
            subtotal += total;

            const row = `
            <tr class="text-center">
                <td class="product-remove">
                    <a href="#" onclick="removeItem('${item.id}')"><span class="icon-close"></span></a>
                </td>
                <td class="image-prod">
                    <div class="img" style="background-image:url('${item.image}');"></div>
                </td>
                <td class="product-name">
                    <h3>${item.itemname}</h3>
                </td>
                <td class="price">₹${item.price}</td>
                <td class="quantity">
                    <div class="input-group mb-3">
                        <button class="btn-number" onclick="changeQty('${item.id}', -1)">−</button>
                        <input type="text" class="form-control text-center" value="${item.qty}" readonly>
                        <button class="btn-number" onclick="changeQty('${item.id}', 1)">+</button>
                    </div>
                </td>
                <td class="total">₹<span class="item-total">${total.toFixed(2)}</span></td>
            </tr>
        `;

            cartBody.insertAdjacentHTML("beforeend", row);
        });

        document.getElementById("subtotalDisplay").textContent = subtotal.toFixed(2);
        document.getElementById("grandTotal").textContent = (subtotal + 50).toFixed(2);
    }

    function changeQty(id, delta) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        const item = cart.find(i => i.id === id);
        if (item) {
            item.qty = Math.max(1, item.qty + delta);
            item.total = item.qty * item.price;
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCartFromLocalStorage();
        }
    }

    function removeItem(id) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart = cart.filter(item => item.id !== id);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCartFromLocalStorage();
    }

    document.addEventListener("DOMContentLoaded", renderCartFromLocalStorage);
</script>
<script>
    function addToCart(newItem) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        const existing = cart.find(item => item.id === newItem.id);
        if (existing) {
            existing.qty += newItem.qty;
            existing.total = existing.qty * existing.price;
        } else {
            newItem.total = newItem.qty * newItem.price;
            cart.push(newItem);
        }

        localStorage.setItem("cart", JSON.stringify(cart));
        alert("Product added to cart!");
        window.location.href = "/cart";  // auto-redirect to cart
    }
</script>
<script>
    function renderCheckout() {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        if (!Array.isArray(cart)) {
            // Agar single object hai to array me convert karo
            cart = [cart];
        }

        const deliveryCharge = 50;

        if (cart.length === 0) {
            document.getElementById("checkoutCartBody").innerHTML = `
        <tr>
          <td colspan="5" class="text-center text-muted">Your cart is empty.</td>
        </tr>
      `;
            document.getElementById("checkoutCartFooter").innerHTML = "";
            return;
        }

        let tbody = "";
        let totalAmount = 0;

        cart.forEach(item => {
            const qty = item.qty || 1;
            const price = parseFloat(item.price) || 0;
            const total = qty * price;

            tbody += `
        <tr>
          <td><img src="${item.image}" style="width: 50px; height: 50px; object-fit: cover;"></td>
          <td>${item.itemname}</td>
          <td class="text-center">${qty}</td>
          <td class="text-end">₹${price.toFixed(2)}</td>
          <td class="text-end">₹${total.toFixed(2)}</td>
        </tr>
      `;

            totalAmount += total;
        });

        // Grand total including delivery charge
        const grandTotal = totalAmount + deliveryCharge;

        document.getElementById("checkoutCartBody").innerHTML = tbody;
        document.getElementById("checkoutCartFooter").innerHTML = `
      <tr class="border-top border-secondary">
        <td colspan="4" class="text-end fw-bold">Subtotal</td>
        <td class="text-end fw-bold">₹${totalAmount.toFixed(2)}</td>
      </tr>
      <tr>
        <td colspan="4" class="text-end fw-bold">Delivery Charge</td>
        <td class="text-end fw-bold">₹${deliveryCharge.toFixed(2)}</td>
      </tr>
      <tr class="border-top border-secondary">
        <td colspan="4" class="text-end fw-bold">Grand Total</td>
        <td class="text-end fw-bold">₹${grandTotal.toFixed(2)}</td>
      </tr>
    `;
    }

    document.addEventListener("DOMContentLoaded", () => {
        console.log("Cart from localStorage:", localStorage.getItem("cart")); // Debugging ke liye
        renderCheckout();
    });
</script>